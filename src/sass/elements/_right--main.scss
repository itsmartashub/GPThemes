/* === RIGHT - CONVERSATION CONTAINER === */
// .grow.overflow-auto.bg-token-main-surface-primary:has([data-testid^='conversation-turn-']) - outdated: "Share Link" page not exists anymore like separated page. Its now part of the chat,
// main [role='presentation'] {
.composer-parent[role='presentation'] {
	container: main / inline-size;
	--p-chat-bubble-multiply: 1.35;

	/* Main Page chat-container  Bg */
	background-color: var(--c-bg-chats-container) !important;

	/* GTP logo in Dual Response chat bubbles */
	.gizmo-bot-avatar {

		&,
		&>div.bg-token-main-surface-primary {
			background-color: var(--c-accent) !important;
		}

		svg {
			color: var(--c-on-accent) !important;
		}
	}

	/* Product/items list in chat bubbles (when search something) */
	.context-list {
		box-shadow: 0 0 0 1px oklch(from var(--c-accent) l c h / 0.15);
		// background-color: oklch(from var(--c-accent) l c h / 0.1);
		background-color: var(--c-surface-2);
		padding-inline: 0.5rem;
		border-radius: var(--br-btn-big);
		@include lift;
	}

}

/* @ === RIGHT - CHATS BUBBLES ===*/
[data-testid^='conversation-turn-'] {

	@include container('md') {
		--p-chat-bubble: .8rem;
		--br-chat-bubble: calc(var(--br) * 1.5);
	}

	@include container('sm') {
		// --br-chat-bubble: var(--br);

		/* Wrapper of each chat-bubbles msg, decreise padding-inline. Spacing from chat bubbles to screen edge */
		.text-base.my-auto.mx-auto[class*="[--thread-content-margin:"] {
			--thread-content-margin: calc(var(--spacing)*2) !important;

			// /* Remove bigger spacing from top on user messages */
			// &.pt-12 {
			// 	padding-top: calc(var(--spacing)*10) !important;
			// }

			// padding-inline: 3% !important;
			// padding-block: calc(var(--p-between-chats) * 0.5) !important
		}
	}

	/* _________ CANVAS in chat bubbles */
	[id^="textdoc-message"] {
		--bg-primary: var(--c-bg-cm) !important;
		--main-surface-primary: var(--c-bg-cm) !important;
		background-color: var(--c-bg-cm) !important;
		will-change: border-color;
		border: 2px solid oklch(from var(--c-accent) l c h / .12) !important;
		transition: border-color .2s;

		/* Gradient on the bottom of code */
		.absolute.bottom-0.z-20.h-24.w-full.transition-colors {
			background: linear-gradient(rgba(0, 0, 0, 0), var(--c-bg-cm)) !important;
		}

		&:hover {
			border-color: oklch(from var(--c-accent) l c h / .3) !important;
		}
	}

	/* @ =================== RIGHT - CHATS BUBBLE =================== */
	/* Flex-end the Reply in user chat bubble */
	[data-message-author-role='user'] {
		// align-items: flex-end !important;
		// /* TODO: Make this only when full-width! See what this can break since the origitnal is overflow-x-hidden, and when i make chats full-width, edit icon for user chat is cut-of so i need to fix it by this and editing the position of the edit icon. BUT HAVE TO TEST THIS!! */
		// overflow: visible !important;

		button:has(>img[alt='Uploaded image']) {
			overflow: hidden;
			border-radius: calc(var(--br) * 1.35) !important;

			img {
				transition: 0.3s $easeInOutSine;
			}

			&:hover {
				img {
					transform: scale(1.2);
				}
			}
		}

		/* â†ªï¸ Reply in msg */
		&>.text-token-text-tertiary.mx-2.my-1.flex.items-start.justify-end.text-sm.font-normal {
			background-color: oklch(from var(--c-accent) l c h / 0.2);
			padding: 0.5rem;
			color: var(--c-accent);
			border-radius: calc(var(--br) * 1.35);
			border-left: 0.35rem solid var(--c-accent);

			svg {
				border-radius: 50vw;
				background-color: oklch(from var(--c-accent) l c h / 0.2);
			}
		}
	}



	/* @ @======================== RIGHT - CHATS BUBBLES - GPT @======================== */
	// &:has([data-message-author-role='assistant']) {
	// ! I HAVE TO CHANGE THE ASSISTENT SELECTOR to ".agent-turn" BCS IT DOESNT EXIST AT SOME SCENARIOS (e.g. when there is canvas only ([id^="textdoc-message"]), without markdown too, when the user stop py Code canvas editing, etc...
	&[data-turn="assistant"] {
		/* This is now .agent-turn -> moved down */
		/* .group\/turn-messages[class*="(--thread-content-max-width)"] {
			background-color: var(--gpthToggleBubbleGpt);
			padding: var(--p-chat-bubble) calc(var(--p-chat-bubble) * var(--p-chat-bubble-multiply));
			border-radius: var(--br-chat-bubble) !important;
		} */

		/* [class*="group-hover/navigation"] je veliki source link u chat bubble kao onaj "ChatGPT Release Note" na sony */
		.not-prose .text-token-link:has(a [class*="group-hover/navigation:"]) {
			background-color: oklch(from var(--c-accent) l c h / .1) !important;
			border: 1px solid oklch(from var(--c-accent) l c h / 0.1) !important;

			/* Circle with light blue which should represents link logo/img? */
			[class*="bg-[#1D53BF0D]"] {
				background-color: oklch(from var(--c-accent) l c h / .25) !important;
			}

			&:hover {
				background-color: oklch(from var(--c-accent) l c h / .2) !important;
			}
		}

		/* Link cards listed from sources listed when using "Search" */
		a[class*="group/nav-list"] {
			background-color: oklch(from var(--c-accent) l c h / 0.1) !important;
			border-color: oklch(from var(--c-accent) l c h / 0.1) !important;
			border-radius: var(--br);
			transition: translate 0.25s $easeInOutSine;

			.text-token-text-primary.decoration-token-link.line-clamp-5 {
				transition: color 0.18s ease-in-out;
			}

			&:is(:hover, :focus) {
				translate: 0 -0.1rem;

				.text-token-text-primary.decoration-token-link.line-clamp-5 {
					color: var(--c-accent) !important;
				}
			}
		}

		/* "SOURCES" button, style for footer icons affects this too!! */
		button.group\/footnote.bg-token-bg-primary.w-fit.rounded-3xl {
			--bg-primary: oklch(from var(--c-accent) l c h / 0.1) !important;
			text-transform: uppercase;

			&:is(:hover, :focus) {
				background-color: var(--c-accent) !important;

				.text-token-text-secondary {
					// color: var(--c-accent) !important;
					color: var(--c-on-accent) !important;
				}
			}
		}

		/* DALLE Image hover buttons - ðŸ‘ðŸ‘Ž */
		.group\/dalle-image {
			@include imgTrans;

			.group-hover\/dalle-image\:visible.absolute {
				button {
					background-color: var(--c-on-accent) !important;
					color: var(--c-accent) !important;
					opacity: .8;

					svg {
						color: currentColor !important;
						transition: none !important;
					}

					&:hover {
						opacity: 1 !important;
						background-color: var(--c-accent) !important;
						color: var(--c-on-accent) !important;
					}
				}
			}
		}

		/* "Voice chat ended" feedback in GPT chat bubble footer - ðŸ‘ðŸ‘Ž | âŒ  */
		.border-gray-100:has(>div>button[aria-label="Thumbs up"]) {
			--main-surface-primary-inverse: var(--c-accent) !important;
			background-color: oklch(from var(--c-accent) l c h / 0.1);
			border-color: oklch(from var(--c-accent) l c h / 0.1) !important;

			/* Buttons: âŒ ðŸ‘ ðŸ‘Ž */
			button[aria-label="Dismiss"],
			button[aria-label="Thumbs up"],
			button[aria-label="Thumbs down"] {
				padding: 0.25rem !important;
			}

			/* âŒ button */
			button[aria-label="Dismiss"] {
				background-color: var(--c-accent) !important;
				margin: auto 0;
				height: min-content;
				margin-right: 0.5rem;
				border-radius: 50vw;

				svg {
					color: var(--c-on-accent) !important;
				}
			}

			/* Vertical separator from ðŸ‘ðŸ‘Ž and âŒ button in  */
			.w-px.flex-1.self-stretch.bg-token-main-surface-tertiary {
				background-color: transparent !important;
			}
		}
	}

	.agent-turn {

		/* REASONING: "Reasoned about [topic] for [X] seconds" title */
		.relative.my-1.min-h-6 {

			/* REASONING: "Reasoned about [topic] for [X] seconds" content */
			.relative.z-0 {
				.origin-left.start-0.end-0.top-0 {
					._markdown_1frq2_10.text-sm.markdown.prose.break-words {
						font-size: calc(calc((var(--fontSize) / 16) * 1rem) * 0.9) !important;
						line-height: calc(calc(var(--lineHeight) / 16) * 0.85) !important;
					}
				}
			}
		}


		/* Source link big cards with image and text that overlaps rigth the chat bubble */
		[data-message-author-role="assistant"] .w-50.shrink-0.snap-start[class*="@5xl/thread:w-61"] {

			.h-full.w-full.bg-clip-padding.bg-token-bg-primary.cursor-pointer.overflow-hidden {
				background-color: oklch(from var(--c-accent) l c h / .08) !important;
				backdrop-filter: blur(0.25rem);
				border-color: oklch(from var(--c-accent) l c h / .1) !important;
				transition: translate 0.25s ease-in-out, box-shadow 0.25s ease-in-out;

				&:hover {
					translate: 0 -2px;
				}
			}
		}

		/* DeepSearch: strange boder */
		[class*="@container"].border-token-border-sharp.mx-\[-16px\].contain-inline-size {
			border: none !important;

			[data-message-author-role="assistant"] {
				border-radius: calc(var(--br-chat-bubble) * 0.7);
				padding: 0.7rem 3%;
				box-shadow: 0 0 0 1px oklch(from var(--c-accent) l c h / .12) !important;
				background-image: var(--c-bg-gradient);
			}
		}
	}

	/* Dual Responses (paragen) title */
	[data-testid="paragen-feedback-title"] {
		background: var(--c-bg-chats-container) !important;
	}

	/* Dual Responses */
	[data-paragen-root="true"] {
		background-color: var(--c-bg-msg-gpt) !important;
	}

	/* User and GPT chats footer */
	[class*="mx-[var(--mini-thread-content-inset)]"]>.flex[class*="justify-"] {
		// border: 2px solid red !important;

		/* And User's and GPT's footer icons */
		// [class*="group-hover/turn-messages:"]
		&>[class*="has-data-[state=open]"] {
			border-radius: 50vw;
			/* 			background: oklch(from var(--c-accent) l c h / .12) !important;
			border: 1px solid oklch(from var(--c-accent) l c h / .08) !important; */

			button {
				color: var(--c-accent) !important;

				svg {
					color: currentColor !important;
				}

				&:is(:hover, :focus) {
					background-color: var(--c-accent) !important;
					color: var(--c-on-accent) !important;

					svg {
						color: currentColor !important;
					}
				}
			}
		}

		// /* Only user's footer icons */
		&.justify-end {
			&>[class*="has-data-[state=open]"] {
				backdrop-filter: blur(10px);
				background: oklch(from var(--c-accent) l c h / .12) !important;
				border: 1px solid oklch(from var(--c-accent) l c h / .08) !important;
			}
		}

		/* &.justify-start {
			&>[class*="has-data-[state=open]"] {
				max-width: max-content !important;
				height: max-content !important;
			}
		} */

		/* Only GPT's footer icons */
		// &.justify-start {
		// 	&>[class*="has-data-[state=open]"] {

		// 		/* SOURCES btn */
		// 		// button.group\/footnote:hover .text-token-text-secondary {
		// 		// 	color: var(--c-on-accent) !important;
		// 		// }
		// 	}
		// }
	}
}