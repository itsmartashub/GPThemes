name: ðŸ“¦ Extension CI/CD caller

on:
    workflow_dispatch:
        inputs:
            skip_build:
                description: "Set to true to skip the main build/packaging job."
                required: false
                default: false
                type: boolean
            skip_biome:
                description: "Set to true to skip Biome (JS) lint checks."
                required: false
                default: false
                type: boolean
            skip_stylelint:
                description: "Set to true to skip Stylelint (CSS/SCSS) checks."
                required: false
                default: false
                type: boolean
    pull_request:

permissions:
    contents: read
    pull-requests: write

jobs:
    call-lint:
        name: ðŸ§¹ Call lint checks
        # pass the input params directly to the reusalbe workflow
        uses: ./.github/workflows/lint.yml
        with:
            skip-biome: ${{ github.event.inputs.skip_biome || false }}
            skip-stylelint: ${{ github.event.inputs.skip_stylelint || false }}

    call-build:
        name: ðŸ—ï¸ Call build and package
        # skip this job if the skip_build input is true (only applicable to manual dispatch)
        if: ${{ github.event_name != 'workflow_dispatch' || github.event.inputs.skip_build != true }}
        # pass the environment context down
        uses: ./.github/workflows/build.yml

    report:
        name: âš ï¸ Failure Report
        # Use always() and check the status because call-build can be skipped via 'if'
        if: always() && needs.call-build.result == 'failure'
        needs: [call-build]
        runs-on: ubuntu-latest
        steps:
            - name: Generate Summary
              run: |
                  echo "### âŒ Build/packaging failed" >> $GITHUB_STEP_SUMMARY
                  echo "The Build and Package job failed. Check its logs for details." >> $GITHUB_STEP_SUMMARY
                  echo "Job status: ${{ needs.call-build.result }}" >> $GITHUB_STEP_SUMMARY
